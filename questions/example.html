<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
</head>
<body>

<div class="question" id="1">
Question 1: 
<form onSubmit="Example.onQuestionSubmit(1);"><input type="text" class="answer"><input type="submit"></form>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
    var Example = (function($) {
        "use strict";

        eventId = {{ event_id }};

        // TODO: Move some of these to common lib?
        getAnswers = function(successCallback) {
            $.ajax({
                url: '/get_answers/' + eventId,
                type: 'GET',
                dataType: 'json',
                success: successCallback
            });
        };

        submitAnswer = function(question, answer, successCallback) {
            $.ajax({
                url: '/answer_question/' + eventId + "/" + question,
                data: JSON.stringify(answer),
                contentType: 'application/json; charset=utf-8',
                success: successCallback
            });
        }

        populateAnswers = function(answers) {
            for (var question in answers) {
                if (answers.hasOwnProperty(question)) {
                    $('#' question '.question answer') .val(answers[question]);
                }
            }
        };

        onQuestionSubmit = function(question) {
            // Find the answer
            answer = $(question + '.question .answer').val();
            submitAnswer(question, answer, function() { getAnswers(populateAnswers); });                
        };

        (function init() {
            // Fill in any answers we already have.
            getAnswers(populateAnswers);
         })();

        return {
            onQuestionSubmit: onQuestionSubmit
        };
    })($);
</script>
</body>
